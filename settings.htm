<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Settings - Time in Words Clock</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Settings - Time in Words Clock - Copyright (c) 2013 djmclean" />
  <meta name="Author" content="djmclean" />
  <link rel="stylesheet" href="settings.css" />

  <script>
  function IsNull(a, b) {
    return (a + "" != "undefined") && (a + "" != "null") ? a : b;
  }

  function Order(a, b) {
    var au = a.toUpperCase();
    var bu = b.toUpperCase();
    return au < bu ? -1 : au === bu ? 0 : +1;
  }

  function GetFontListX() {
    var o = document.getElementById('dialogHelperId');
    if(o && o.fonts) {
      var fontList = [];
      for(var x = 0; x < o.fonts.count; x++)
        fontList[x] = o.fonts(x + 1);
      return fontList.sort(Order);
    }
    return [];
  }

  function CreateFontOptions(fonts) {
    if(document.getElementById("fontFace").tagName.toUpperCase() != "SELECT") {
      var currentVal = document.getElementById("fontFace").value;
      document.getElementById("divFont").innerHTML = '<label for="fontFace">Font&nbsp;Face</label><select id="fontFace" />';
      var o = document.getElementById("fontFace");
      var oOption = document.createElement("option");
      o.add(oOption);
      oOption.value = oOption.text = "sans-serif";
      for(var x = 0; x < fonts.length; x++) {
        oOption = document.createElement("option");
        o.add(oOption);
        oOption.value = oOption.text = fonts[x];
      }
      document.getElementById("fontFace").value = currentVal;
    }
  }

  function getFontList(user_fonts) {
    var fonts = null;
    var obj = document.getElementById('font_getter');
    if(typeof(obj.GetVariable) != 'undefined')
      fonts = obj.GetVariable('/:user_fonts');
    else if(typeof(user_fonts) != 'undefined')
      fonts = unescape(user_fonts);
    if(fonts) {
      if(typeof(fonts) == 'string')
        fonts = fonts.split(',');
      CreateFontOptions(fonts.sort(Order));
    }
  }

  function btnReset_onclick() {
    document.getElementById("language").value = "en";
    document.getElementById("bgColor").value = "#000000";
    document.getElementById("txtColor").value = "#aaaaaa";
    document.getElementById("fontFace").value = "sans-serif";
    document.getElementById("italic").checked = false;
    document.getElementById("roundUp").checked = true;
  }

  function btnOK_onclick() {
    btnApply_onclick();
    window.close();
  }

  function btnCancel_onclick() {
    try {
      window.opener.body_onload();
    }
    catch(e) {
    }
    window.close();
  }

  function btnApply_onclick() {
    if(window.localStorage) {
      localStorage.setItem("language", document.getElementById("language").value);
      localStorage.setItem("bgColor", document.getElementById("bgColor").value);
      localStorage.setItem("txtColor", document.getElementById("txtColor").value);
      localStorage.setItem("fontFace", document.getElementById("fontFace").value);
      localStorage.setItem("italic", document.getElementById("italic").checked ? "true" : "false");
      localStorage.setItem("roundUp", document.getElementById("roundUp").checked ? "true" : "false");
    }
    if(window.opener && window.opener.bgColor) {
      window.opener.language = document.getElementById("language").value;
      window.opener.bgColor = document.getElementById("bgColor").value;
      window.opener.txtColor = document.getElementById("txtColor").value;
      window.opener.fontFace = document.getElementById("fontFace").value;
      window.opener.italic = document.getElementById("italic").checked ? "true" : "false";
      window.opener.roundUp = document.getElementById("roundUp").checked ? "true" : "false";
      window.opener.Redraw();
    }
  }

  function body_onkeydown(e) {
    var unicode = e.charCode ? e.charCode : e.keyCode;
    if(unicode == 13)
      btnOK_onclick();
    if(unicode == 27)
      btnCancel_onclick();
  }

  function body_onload() {
    var fonts = GetFontListX();
    if(fonts.length > 0)
      CreateFontOptions(fonts);
    if(window.opener && window.opener.bgColor) {
      document.getElementById("language").value = window.opener.language;
      document.getElementById("bgColor").value = window.opener.bgColor;
      document.getElementById("txtColor").value = window.opener.txtColor;
      document.getElementById("fontFace").value = window.opener.fontFace;
      document.getElementById("italic").checked = (window.opener.italic == "true");
      document.getElementById("roundUp").checked = (window.opener.roundUp == "true");
    }
    else if(window.localStorage) {
      document.getElementById("btnApply").style.display = "none";
      document.getElementById("language").value = IsNull(localStorage.getItem("language"), "en");
      document.getElementById("bgColor").value = IsNull(localStorage.getItem("bgColor"), "#000000");
      document.getElementById("txtColor").value = IsNull(localStorage.getItem("txtColor"), "#aaaaaa");
      document.getElementById("fontFace").value = IsNull(localStorage.getItem("fontFace"), "sans-serif");
      document.getElementById("italic").checked = (IsNull(localStorage.getItem("italic"), "false") == "true");
      document.getElementById("roundUp").checked = (IsNull(localStorage.getItem("roundUp"), "true") == "true");
    }
    else {
      alert("Sorry, your browser does not support HTML5 local storage.");
      if(history.length > 1)
        history.go(-1);
      else
        window.close();
    }
  }
  </script>
</head>

<body onload="body_onload()" onkeydown="body_onkeydown(event)">
  <object id="dialogHelperId" classid="clsid:3050f819-98b5-11cf-bb82-00aa00bdce0b" width="0px" height="0px" style="float:left"></object>
  <object id="font_getter" name="font_getter" type="application/x-shockwave-flash" data="get_fonts.swf" width="0px" height="0px" style="float:left"><param name="movie" value="get_fonts.swf" /></object>
  <h1>Time in Words Clock by <a href="http://www.djmclean.freeserve.co.uk" target="djm">djmclean</a></h1>
  <fieldset>
    <legend>Settings</legend>
    <div class="box-text">
      <label for="language">Language</label>
      <select id="language">
        <option value="da">Dansk</option>
        <option value="en">English</option>
        <option value="fr">Français</option>
        <option value="sv">Svensk</option>
        <option value="ja-hira">にほんご</option>
        <option value="ja">日本語</option>
        <option value="zh">中文</option>
      </select>
    </div>
    <div class="box-text">
      <label for="bgColor">Background&nbsp;Colour</label>
      <input type="color" id="bgColor" maxlength="250" size="20" />
    </div>
    <div class="box-text">
      <label for="txtColor">Text&nbsp;Colour</label>
      <input type="color" id="txtColor" maxlength="250" size="20" />
    </div>
    <div id="divFont" class="box-text">
      <label for="fontFace">Font&nbsp;Face</label>
      <input type="text" id="fontFace" maxlength="250" size="20" />
    </div>
    <div class="box-check">
      <input type="checkbox" id="italic" />
      <label for="italic">Italic</label>
    </div>
    <div class="box-check">
      <input type="checkbox" id="roundUp" />
      <label for="roundUp">Round&nbsp;up&nbsp;to&nbsp;nearest&nbsp;5&nbsp;min</label>
    </div>
    <div class="buttonrow">
      <button type="button" onclick="btnReset_onclick()">Reset&nbsp;All</button>
    </div>
  </fieldset>

  <div class="buttonrow">
    <button type="button" onclick="btnOK_onclick()">OK</button>
    <button type="button" onclick="btnCancel_onclick()">Cancel</button>
    <button type="button" id="btnApply" onclick="btnApply_onclick()">Apply</button>
  </div>
</body>
</html>
